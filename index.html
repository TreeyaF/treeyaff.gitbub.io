<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCM Blurb ææŠ¥ - æµ‹è¯•ç‰ˆ</title>
    
    <!-- Supabase SDK -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; }
        .header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 30px; 
            text-align: center; 
        }
        
        .nav-tabs { display: flex; background: #f8f9fa; }
        .nav-tab { 
            flex: 1; 
            padding: 15px; 
            border: none; 
            background: #f8f9fa; 
            cursor: pointer; 
            border-bottom: 3px solid transparent;
        }
        .nav-tab:hover { background: #e9ecef; }
        .nav-tab.active { 
            background: white; 
            border-bottom-color: #007bff; 
        }
        
        .tab-content { 
            display: none; 
            padding: 20px; 
            min-height: 500px;
        }
        .tab-content.active { display: block; }
        
        .calendar-container { margin: 20px 0; }
        .calendar-grid { 
            display: grid; 
            grid-template-columns: repeat(7, 1fr); 
            gap: 1px; 
            background: #ddd; 
            border: 1px solid #ddd; 
        }
        .calendar-header { 
            background: #f8f9fa; 
            padding: 10px; 
            text-align: center; 
            font-weight: bold; 
        }
        .calendar-day { 
            background: white; 
            min-height: 100px; 
            padding: 5px; 
            position: relative; 
        }
        .calendar-day.clickable:hover { background: #f0f8ff; }
        .calendar-day.today { background: #e3f2fd; }
        .calendar-day.other-month { opacity: 0.3; }
        
        .event { 
            background: #007bff; 
            color: white; 
            padding: 2px 4px; 
            margin: 1px 0; 
            border-radius: 3px; 
            font-size: 10px; 
        }
        .event.pending { background: #6c757d; }
        
        #userRole {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>OCM Blurb ææŠ¥ - æµ‹è¯•ç‰ˆ</h1>
            
            <!-- ç”¨æˆ·è§’è‰²é€‰æ‹© -->
            <div style="margin-top: 15px; padding: 10px; background: rgba(255,255,255,0.2); border-radius: 5px;">
                <label style="color: white; font-weight: bold;">é€‰æ‹©æ‚¨çš„è§’è‰²ï¼š</label>
                <select id="userRole" onchange="switchUserRole()" style="margin-left: 10px; padding: 5px; border-radius: 3px; border: none;">
                    <option value="requestor">ğŸ“ Requestor</option>
                    <option value="ocm_poc">ğŸ‘¨â€ğŸ’¼ OCM POC</option>
                </select>
                <span id="roleDescription" style="margin-left: 15px; font-size: 12px; opacity: 0.9;">
                    å¯ä»¥ææŠ¥è¯·æ±‚å’ŒæŸ¥çœ‹å®¡æ ¸è®°å½•
                </span>
            </div>
            
            <div style="margin-top: 10px;">
                <button onclick="testFunction()" style="background: #10b981; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; margin-right: 8px; font-size: 12px;">
                    ğŸ§ª æµ‹è¯•åŠŸèƒ½
                </button>
                <button onclick="showDebugInfo()" style="background: #6366f1; color: white; padding: 6px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">
                    ğŸ” è°ƒè¯•
                </button>
            </div>
        </div>

        <div class="nav-tabs">
            <button id="calendarTab" class="nav-tab active" onclick="showTab('calendar')">ğŸ“… å‘é€æ—¥å†</button>
            <button id="adminTab" class="nav-tab" onclick="showTab('admin')" style="display: none;">ğŸ‘¨â€ğŸ’¼ ç®¡ç†å‘˜å®¡æ ¸</button>
            <button id="recordsTab" class="nav-tab" onclick="showTab('records')">ğŸ“Š å®¡æ ¸è®°å½•</button>
        </div>

        <div id="calendar" class="tab-content active">
            <h2>ğŸ“… æ—¥å†è§†å›¾</h2>
            <div class="calendar-container">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <button onclick="previousMonth()">&lt; ä¸Šæœˆ</button>
                    <h3 id="currentMonth">2025å¹´ 1æœˆ</h3>
                    <button onclick="nextMonth()">ä¸‹æœˆ &gt;</button>
                </div>
                <div id="calendarGrid" class="calendar-grid">
                    <!-- æ—¥å†å†…å®¹å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <div id="admin" class="tab-content">
            <h2>ğŸ‘¥ ç®¡ç†å‘˜å®¡æ ¸</h2>
            <div id="pendingRequests">
                <p>ç®¡ç†å‘˜å®¡æ ¸é¡µé¢</p>
            </div>
        </div>

        <div id="records" class="tab-content">
            <h2>ğŸ“Š å®¡æ ¸è®°å½•</h2>
            <div id="approvedEvents">
                <p>å®¡æ ¸è®°å½•é¡µé¢</p>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentDate = new Date();
        let currentUserRole = 'requestor';
        let isOCMAuthenticated = false;
        
        const OCM_PASSWORD = 'OCM2025';
        
        const ROLES = {
            requestor: {
                name: 'ğŸ“ Requestor',
                description: 'å¯ä»¥ææŠ¥è¯·æ±‚å’ŒæŸ¥çœ‹å®¡æ ¸è®°å½•',
                tabs: ['calendar', 'records']
            },
            ocm_poc: {
                name: 'ğŸ‘¨â€ğŸ’¼ OCM POC',
                description: 'å¯ä»¥å®¡æ ¸è¯·æ±‚å’ŒæŸ¥çœ‹æ‰€æœ‰å†…å®¹',
                tabs: ['calendar', 'admin', 'records']
            }
        };

        // åˆ‡æ¢ç”¨æˆ·è§’è‰²
        function switchUserRole() {
            const roleSelect = document.getElementById('userRole');
            const newRole = roleSelect.value;
            
            console.log(`[PERMISSION] å°è¯•åˆ‡æ¢è§’è‰²: ${currentUserRole} -> ${newRole}`);
            
            if (newRole === 'ocm_poc') {
                // OCM POCéœ€è¦å¯†ç éªŒè¯
                authenticateOCM((success) => {
                    if (success) {
                        currentUserRole = newRole;
                        isOCMAuthenticated = true;
                        updateUIForRole();
                        alert('OCM POC è®¤è¯æˆåŠŸï¼');
                    } else {
                        // è®¤è¯å¤±è´¥ï¼Œæ¢å¤åˆ°åŸè§’è‰²
                        roleSelect.value = currentUserRole;
                        alert('OCM POC è®¤è¯å¤±è´¥ï¼');
                    }
                });
            } else {
                // åˆ‡æ¢åˆ°Requestor
                currentUserRole = newRole;
                isOCMAuthenticated = false;
                updateUIForRole();
                alert('å·²åˆ‡æ¢åˆ° Requestor è§’è‰²');
            }
        }

        // OCM POC è®¤è¯
        function authenticateOCM(callback) {
            const password = prompt('è¯·è¾“å…¥ OCM POC å¯†ç ï¼š');
            
            if (password === null) {
                callback(false);
                return;
            }
            
            if (password === OCM_PASSWORD) {
                callback(true);
            } else {
                alert('å¯†ç é”™è¯¯ï¼è¯·è”ç³»ç®¡ç†å‘˜è·å–æ­£ç¡®å¯†ç ã€‚');
                callback(false);
            }
        }

        // æ ¹æ®è§’è‰²æ›´æ–°ç•Œé¢
        function updateUIForRole() {
            const role = ROLES[currentUserRole];
            
            console.log(`[PERMISSION] æ›´æ–°ç•Œé¢æƒé™:`, role);
            
            // æ›´æ–°è§’è‰²æè¿°
            document.getElementById('roleDescription').textContent = role.description;
            
            // æ§åˆ¶æ ‡ç­¾é¡µæ˜¾ç¤º
            document.getElementById('calendarTab').style.display = 
                role.tabs.includes('calendar') ? 'block' : 'none';
            document.getElementById('adminTab').style.display = 
                role.tabs.includes('admin') ? 'block' : 'none';
            document.getElementById('recordsTab').style.display = 
                role.tabs.includes('records') ? 'block' : 'none';
            
            // å¦‚æœå½“å‰æ ‡ç­¾é¡µä¸å¯è§ï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªå¯è§æ ‡ç­¾é¡µ
            const currentTab = document.querySelector('.tab-content.active');
            if (currentTab && !role.tabs.includes(currentTab.id)) {
                showTab(role.tabs[0]);
            }
        }

        // æ˜¾ç¤ºæ ‡ç­¾é¡µ
        function showTab(tabName) {
            console.log(`[TAB] åˆ‡æ¢åˆ°æ ‡ç­¾é¡µ: ${tabName}`);
            
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            
            // æ‰¾åˆ°å¯¹åº”çš„æ ‡ç­¾æŒ‰é’®å¹¶æ¿€æ´»
            const tabButton = document.getElementById(tabName + 'Tab');
            if (tabButton) {
                tabButton.classList.add('active');
            }
        }

        // ç”Ÿæˆç®€å•æ—¥å†
        function generateCalendar() {
            const calendar = document.getElementById('calendarGrid');
            const monthNames = ['ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'];
            const dayNames = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            
            document.getElementById('currentMonth').textContent = `${currentDate.getFullYear()}å¹´ ${monthNames[currentDate.getMonth()]}`;
            
            let calendarHTML = '';
            
            // æ·»åŠ æ˜ŸæœŸæ ‡é¢˜
            dayNames.forEach(day => {
                calendarHTML += `<div class="calendar-header">${day}</div>`;
            });
            
            // ç”Ÿæˆæ—¥å†æ ¼å­ï¼ˆç®€åŒ–ç‰ˆï¼‰
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            for (let i = 0; i < 42; i++) {
                const cellDate = new Date(startDate.getTime() + (i * 24 * 60 * 60 * 1000));
                const isCurrentMonth = cellDate.getMonth() === currentDate.getMonth();
                const isToday = cellDate.toDateString() === new Date().toDateString();
                
                let dayClass = 'calendar-day';
                if (!isCurrentMonth) dayClass += ' other-month';
                if (isToday) dayClass += ' today';
                if (isCurrentMonth) dayClass += ' clickable';
                
                calendarHTML += `
                    <div class="${dayClass}">
                        <div style="font-weight: bold;">${cellDate.getDate()}</div>
                        <div class="event">æµ‹è¯•äº‹ä»¶</div>
                        ${currentUserRole === 'ocm_poc' && isOCMAuthenticated ? 
                            '<button onclick="alert(\'åˆ é™¤åŠŸèƒ½\')" style="background: red; color: white; border: none; padding: 2px; font-size: 10px;">ğŸ—‘ï¸</button>' : 
                            '<button style="background: #ccc; border: none; padding: 2px; font-size: 10px;">ğŸ“‹</button>'
                        }
                    </div>
                `;
            }
            
            calendar.innerHTML = calendarHTML;
        }

        // ä¸Šæœˆ
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
        }

        // ä¸‹æœˆ
        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
        }

        // æµ‹è¯•åŠŸèƒ½
        function testFunction() {
            console.log('=== åŠŸèƒ½æµ‹è¯• ===');
            console.log('å½“å‰è§’è‰²:', currentUserRole);
            console.log('OCMè®¤è¯:', isOCMAuthenticated);
            console.log('å¯è§æ ‡ç­¾é¡µ:', ROLES[currentUserRole].tabs);
            
            alert(`åŠŸèƒ½æµ‹è¯•ï¼š
è§’è‰²: ${ROLES[currentUserRole].name}
è®¤è¯: ${isOCMAuthenticated ? 'å·²è®¤è¯' : 'æœªè®¤è¯'}
å¯è§æ ‡ç­¾: ${ROLES[currentUserRole].tabs.join(', ')}`);
        }

        // æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        function showDebugInfo() {
            const info = `=== è°ƒè¯•ä¿¡æ¯ ===
å½“å‰è§’è‰²: ${ROLES[currentUserRole].name}
OCMè®¤è¯: ${isOCMAuthenticated ? 'å·²è®¤è¯' : 'æœªè®¤è¯'}
å¯è§æ ‡ç­¾é¡µ: ${ROLES[currentUserRole].tabs.join(', ')}`;
            
            console.log(info);
            alert(info);
        }

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('[INIT] é¡µé¢åˆå§‹åŒ–');
            updateUIForRole();
            generateCalendar();
        });
    </script>
</body>
</html>
